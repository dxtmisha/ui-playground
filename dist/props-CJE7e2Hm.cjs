"use strict";var u=Object.defineProperty;var h=(i,t,s)=>t in i?u(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s;var a=(i,t,s)=>(h(i,typeof t!="symbol"?t+"":t,s),s);const o=require("vue"),c=require("./DesignConstructorAbstract-CEByexyZ.cjs"),n=require("./props-C3O5u-hn.cjs");class m{constructor(){a(this,"items",[])}is(t){return!!this.getItem(t)}isComponent(t){var s;return!!((s=t.dataset)!=null&&s[n.MutationCollect.getKeyUi()])}get(){return this.items}getItem(t){var s;return(s=this.items)==null?void 0:s[this.find(t)]}add(t){return this.isComponent(t)&&!this.is(t)&&!n.MutationCollect.closestInit(t)&&this.items.push(new n.MutationDataItem(t)),this}remove(t){const s=this.find(t);return s>=0&&(this.items[s].disconnect(),this.items.splice(s,1)),this}find(t){return this.items.findIndex(s=>s.is(t))}}class l{constructor(t,s){a(this,"mutation");this.addCallback=t,this.removeCallback=s}start(){return this.mutation||(this.mutation=new MutationObserver(t=>this.callback(t)),this.mutation.observe(document.body,{attributes:!1,attributeOldValue:!1,characterData:!1,characterDataOldValue:!1,childList:!0,subtree:!0})),this}end(){return this.mutation&&(this.mutation.disconnect(),this.mutation=void 0),this}callback(t){t.forEach(s=>{s.removedNodes.forEach(e=>this.removeCallback(e)),s.addedNodes.forEach(e=>this.addCallback(e))})}}class d{constructor(t,s){a(this,"mutation");this.items=t,this.update=s}start(){this.mutation&&this.end();const t=this.items.get();if(t.length>0){this.mutation=new MutationObserver(s=>this.callback(s));for(const s of t)this.mutation.observe(s.getElement(),{attributes:!0,attributeOldValue:!1,characterData:!1,characterDataOldValue:!1,childList:!1,subtree:!1})}return this}end(){return this.mutation&&(this.mutation.disconnect(),this.mutation=void 0),this}callback(t){t.forEach(s=>{s.type==="attributes"&&this.update(s.target)})}}class f{constructor(t){a(this,"mutationGlobal");a(this,"mutationItems");a(this,"items",new m);this.callback=t,this.mutationGlobal=new l(s=>this.add(s),s=>this.remove(s)),this.mutationItems=new d(this.items,s=>{var e;return(e=this.items.getItem(s))==null?void 0:e.update()})}start(){return this.addList(),this.mutationGlobal.start(),this.mutationItems.start(),this}stop(){return this.mutationGlobal.end(),this}add(t){this.items.add(t),this.addList(t),this.callback(),this.mutationItems.start()}addList(t=document.body){n.MutationCollect.find(t).forEach(s=>this.items.add(s))}remove(t){this.items.remove(t),this.removeList(t),this.callback(),this.mutationItems.start()}removeList(t=document.body){n.MutationCollect.find(t,n.MutationStatus.init).forEach(s=>this.items.remove(s))}}class b{constructor(){a(this,"mutation");a(this,"items",o.shallowRef([]));this.mutation=new f(()=>this.update()),o.onBeforeMount(async()=>{await o.nextTick(),requestAnimationFrame(()=>{this.mutation.start(),this.update()})}),o.onUnmounted(()=>this.mutation.stop())}update(){return this.items.value=[...this.mutation.items.get()],this}}class p extends c.DesignConstructorAbstract{constructor(s,e,r){super(s,e,r);a(this,"mutation");this.mutation=new b,this.init()}makeOptions(){return this}initSetup(){return{items:this.mutation.items}}initExpose(){return{items:this.setup().items}}initClasses(){return{main:{}}}initStyles(){return{}}initRender(){const s=this.setup(),e=[];return this.components.is("item")&&s.items.value.forEach(r=>{this.components.renderAdd(e,"item",{item:r},void 0,r.getId())}),o.h("div",{...this.getAttrs(),ref:this.element,class:s.classes.value.main},e)}}const v={disabled:Boolean};exports.MutationDesign=p;exports.propsMutation=v;

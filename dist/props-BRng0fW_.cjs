"use strict";var u=Object.defineProperty;var h=(s,t,i)=>t in s?u(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i;var a=(s,t,i)=>(h(s,typeof t!="symbol"?t+"":t,i),i);const n=require("vue"),c=require("./DesignConstructorAbstract-C1iC14vk.cjs"),o=require("./MutationDataItem-D_mW4zvW.cjs"),m=require("./MutationGlobal-DqatDy6B.cjs");class l{constructor(){a(this,"items",[])}is(t){return!!this.getItem(t)}isComponent(t){var i;return!!((i=t.dataset)!=null&&i[o.MutationCollect.getKeyUi()])}get(){return this.items}getItem(t){var i;return(i=this.items)==null?void 0:i[this.find(t)]}add(t){return this.isComponent(t)&&!this.is(t)&&!o.MutationCollect.closestInit(t)&&this.items.push(new o.MutationDataItem(t)),this}remove(t){const i=this.find(t);return i>=0&&(this.items[i].disconnect(),this.items.splice(i,1)),this}find(t){return this.items.findIndex(i=>i.is(t))}}class d{constructor(t,i){a(this,"mutation");this.addCallback=t,this.removeCallback=i}start(){return this.mutation||(this.mutation=new MutationObserver(t=>this.callback(t)),this.mutation.observe(document.body,{attributes:!1,attributeOldValue:!1,characterData:!1,characterDataOldValue:!1,childList:!0,subtree:!0})),this}end(){return this.mutation&&(this.mutation.disconnect(),this.mutation=void 0),this}callback(t){t.forEach(i=>{i.removedNodes.forEach(e=>this.removeCallback(e)),i.addedNodes.forEach(e=>this.addCallback(e))})}}class f{constructor(t,i){a(this,"mutation");this.items=t,this.update=i}start(){this.mutation&&this.end();const t=this.items.get();if(t.length>0){this.mutation=new MutationObserver(i=>this.callback(i));for(const i of t)this.mutation.observe(i.getElement(),{attributes:!0,attributeOldValue:!1,characterData:!1,characterDataOldValue:!1,childList:!1,subtree:!1})}return this}end(){return this.mutation&&(this.mutation.disconnect(),this.mutation=void 0),this}callback(t){t.forEach(i=>{i.type==="attributes"&&this.update(i.target)})}}class b{constructor(t){a(this,"mutationGlobal");a(this,"mutationItems");a(this,"items",new l);this.callback=t,this.mutationGlobal=new d(i=>this.add(i),i=>this.remove(i)),this.mutationItems=new f(this.items,i=>{var e;return(e=this.items.getItem(i))==null?void 0:e.update()})}start(){return this.addList(),this.mutationGlobal.start(),this.mutationItems.start(),this}stop(){return this.mutationGlobal.end(),this}add(t){this.items.add(t),this.addList(t),this.callback(),this.mutationItems.start()}addList(t=document.body){o.MutationCollect.find(t).forEach(i=>this.items.add(i))}remove(t){this.items.remove(t),this.removeList(t),this.callback(),this.mutationItems.start()}removeList(t=document.body){o.MutationCollect.find(t,m.MutationStatus.init).forEach(i=>this.items.remove(i))}}class p{constructor(){a(this,"mutation");a(this,"items",n.shallowRef([]));this.mutation=new b(()=>this.update()),n.onBeforeMount(async()=>{await n.nextTick(),requestAnimationFrame(()=>{this.mutation.start(),this.update()})}),n.onUnmounted(()=>this.mutation.stop())}update(){return this.items.value=[...this.mutation.items.get()],this}}class v extends c.DesignConstructorAbstract{constructor(i,e,r){super(i,e,r);a(this,"mutation");this.mutation=new p,this.init()}makeOptions(){return this}initSetup(){return{items:this.mutation.items}}initExpose(){return{items:this.setup().items}}initClasses(){return{main:{}}}initStyles(){return{}}initRender(){const i=this.setup(),e=[];return this.components.is("item")&&i.items.value.forEach(r=>{this.components.renderAdd(e,"item",{item:r},void 0,r.getId())}),n.h("div",{...this.getAttrs(),ref:this.element,class:i.classes.value.main},e)}}const M={disabled:Boolean};exports.MutationDesign=v;exports.propsMutation=M;

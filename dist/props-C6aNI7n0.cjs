"use strict";var A=Object.defineProperty;var K=(o,t,s)=>t in o?A(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s;var n=(o,t,s)=>(K(o,typeof t!="symbol"?t+"":t,s),s);const c=require("vue"),r=require("./object-D6teWcGS.cjs"),_=require("./DesignConstructorAbstract-CEByexyZ.cjs"),g=require("./string-C-Ov7RqZ.cjs"),b=require("./element-B5HRaKMF.cjs"),N=require("./useEnv-D4nMsB2C.cjs"),v="d-mutation",D=g.toKebabCase(N.useEnv("DESIGNS_MAIN","design")),F=g.toKebabCase(N.useEnv("DESIGNS_GLOBAL","ui")),L="init",w="end",p="__UI_PROJECT";var l=(o=>(o.new="new",o[o.init=L]="init",o[o.end=w]="end",o))(l||{});class m{static getKeyUi(){return F}static getKeyInit(){return L}static getKeyEnd(){return w}static getAttributeUi(){return`data-${this.getKeyUi()}`}static getClassInit(){return`${v}--${this.getKeyInit()}`}static getClassEnd(){return`${v}--${this.getKeyEnd()}`}static find(t=document.body,s=l.new){const e=[];if("querySelector"in t){const i=this.getSelectorByStatus(s);t.querySelector(i)&&t.querySelectorAll(i).forEach(a=>e.push(a))}return e}static closestInit(t){var s,e;return!!((s=t==null?void 0:t.closest)!=null&&s.call(t,this.getSelectorInit())||!((e=t==null?void 0:t.closest)!=null&&e.call(t,"body")))}static getSelectorNew(){return`*[${this.getAttributeUi()}]:not(.${this.getClassInit()}):not(.${this.getClassEnd()})`}static getSelectorInit(){return`*[${this.getAttributeUi()}].${this.getClassInit()}`}static getSelectorEnd(){return`*[${this.getAttributeUi()}].${this.getClassEnd()}`}static getSelectorByStatus(t){switch(t){case l.init:return`${this.getSelectorInit()}, ${this.getSelectorEnd()}`;case l.end:return this.getSelectorEnd();default:return this.getSelectorNew()}}}class h{static isFunction(t){return t in this.functions}static isClass(t){return t in this.classes}static isComponent(t){return t in this.components}static getComponentList(){return this.components}static getComponentGlobal(){return p in window?window[p]:{}}static getComponentGlobalItem(t){var s;if(p in window)return((s=window[p])==null?void 0:s[t])??void 0}static getComponentVue(t){if(t in this.components)return this.components[t]}static getComponentItem(t){if(t in this.compItems)return this.compItems[t].item}static addFunction(t,s){this.isFunction(t)||(this.functions[t]=s)}static addClass(t,s){this.isClass(t)||(this.classes[t]=s)}static addComponent(t,s){this.isComponent(t)||(this.components[t]=s)}static addFunctionList(t){r.forEach(t,(s,e)=>{this.addFunction(e,s)})}static addClassList(t){r.forEach(t,(s,e)=>{this.addClass(e,s)})}static addComponentList(t){r.forEach(t,(s,e)=>{this.addComponent(e,s)})}static registrationComponent(t,s,e){if(this.compItems[t]={item:s,callback:e},t in this.compCaching){const i=this.compCaching[t];return delete this.compCaching[t],i}}static comp(t,s){t in this.compItems?this.compItems[t].callback(s):this.compCaching[t]=s}static removeComponent(t){t in this.compItems&&delete this.compItems[t]}}n(h,"functions",{}),n(h,"classes",{}),n(h,"components",{}),n(h,"compItems",{}),n(h,"compCaching",{});class y{constructor(t){n(this,"id");n(this,"componentName");n(this,"static");n(this,"slots",{});n(this,"props",{});n(this,"callback");var s;this.element=t,this.id=b.getElementId(t),this.componentName=((s=t.dataset)==null?void 0:s[m.getKeyUi()])??"component",this.static=l.new,this.slots=this.initSlots(),this.setStatus(l.init),this.element.classList.add(this.getClassMain())}is(t){return this.element===t}isLink(){return!!this.componentName.match("/")}getId(){return this.id}getComponentName(){if(this.isLink())return this.componentName;const t=g.toCamelCaseFirst(this.componentName);return h.isComponent(t)?t:g.toCamelCaseFirst(`${D}-${this.componentName}`)}getDesign(){return g.toKebabCase(this.getComponentName()).replace(/-.*?$/,"")}getClassMain(){return`${this.getDesign()}-init`}getElement(){return this.element}getStatus(){return this.static}getProps(){return{...this.getDataset(),...this.props}}getSlots(){return this.slots}setStatus(t){switch(this.removeClasses(),this.static=t,this.static){case l.init:this.element.classList.add(m.getClassInit());break;case l.end:this.element.classList.add(m.getClassEnd());break}return this}registration(t,s){const e=h.registrationComponent(this.getId(),t,i=>{r.isFilled(i)&&this.setProps(i).update()});return e&&this.setProps(e),this.callback=s,this}update(){var t;return(t=this.callback)==null||t.call(this,this.getProps()),this}disconnect(){return h.removeComponent(this.getId()),this}getDataset(){const t={};return r.forEach(this.element.dataset,(s,e)=>{e!==m.getKeyUi()&&(t[e]=r.transformation(s))}),t}setProps(t){return r.isFilled(t)&&r.forEach(t,(s,e)=>{e==="slots"?this.setSlots(s):this.props[e]=s}),this}setSlots(t){return r.isFilled(t)&&r.forEach(t,(s,e)=>{this.slots[e]=this.initChildrenList(r.toArray(s))}),this}initSlots(){const t={},s=[];for(const e of this.element.children){const i=e.getAttribute("data-slot");if(i)t[i]=this.initChildrenList(e.childNodes);else{const a=this.initChildren(e);a&&("default"in t?t.default.push(a):t.default=[a])}s.push(e)}for(const e of s)this.element.removeChild(e);return t}initChildrenList(t){const s=[];for(const e of t){const i=this.initChildren(e);i&&s.push(i)}return s}initChildren(t){var e,i;if(t instanceof HTMLElement)return{tag:t.nodeName,attributes:{...b.getAttributes(t),innerHTML:(t==null?void 0:t.innerHTML)??""}};const s=(i=(e=t==null?void 0:t.textContent)==null?void 0:e.trim)==null?void 0:i.call(e);if(r.isFilled(s))return s;if(r.isString(t)&&r.isFilled(t))return t}removeClasses(){return this.element.classList.remove(m.getClassInit()),this.element.classList.remove(m.getClassEnd()),this}}class U{constructor(t,s){n(this,"mainElement",document.body);n(this,"componentName","div");n(this,"componentItem",c.shallowRef());n(this,"binds",c.shallowRef({}));n(this,"slots",c.shallowRef({}));var e;this.props=t,t.item&&(this.mainElement=t.item.getElement(),this.componentName=t.item.getComponentName(),t.item.registration(s,()=>this.update()),this.initComponentItem().then(i=>{this.componentItem.value=i})),(e=t.item)==null||e.setStatus(l.end),this.update()}update(){var s,e;const t=(s=this.props.item)==null?void 0:s.getSlots();return this.binds.value={...((e=this.props.item)==null?void 0:e.getProps())??{}},this.slots.value=t?{...t}:void 0,this}getComponentGlobalItem(){var t;return(t=h.getComponentGlobalItem(this.componentName))==null?void 0:t.item}async initComponentItem(){return new Promise(t=>{var e;const s=this.getComponentGlobalItem();if(s)t(s);else if((e=this.props.item)!=null&&e.isLink()){let i=24;const a=setInterval(()=>{if(console.log("repeat",this.componentName),i-- >0){const C=this.getComponentGlobalItem();C&&(clearInterval(a),t(C))}else clearInterval(a),t(c.resolveComponent(this.componentName))},64)}else t(c.resolveComponent(this.componentName))})}}class M extends _.DesignConstructorAbstract{constructor(s,e,i){super(s,e,i);n(this,"mutation");this.mutation=new U(e,this.element),this.init()}makeOptions(){return this}initSetup(){return{mainElement:this.mutation.mainElement,componentName:this.mutation.componentName,componentItem:this.mutation.componentItem,binds:this.mutation.binds,slots:this.mutation.slots,renderSlots:c.computed(()=>this.renderSlots())}}initExpose(){return{}}initClasses(){return{main:{}}}initStyles(){return{}}initRender(){var e;const s=this.setup();if(s.componentItem.value)return c.h(c.Teleport,{ref:this.element,class:(e=this.classes)==null?void 0:e.value.main,to:s.mainElement},[c.h(s.componentItem.value,s.binds.value,s.renderSlots.value)])}renderSlots(){const s=this.setup(),e={},i=s.slots.value;return i&&r.forEach(i,(a,C)=>{const d=[];let I=!1;a.forEach(u=>{typeof u=="string"?d.push(u):d.push(c.h(u.tag,{...u.attributes}))}),e[C]=u=>{var E,S;if(!I&&u){const f=d==null?void 0:d[0];f&&"UI"in window&&r.isObjectNotArray(f)&&((E=f.props)!=null&&E["data-ui"])&&(window.UI.comp((S=f.props)==null?void 0:S.id,u),I=!0)}return d}}),e}}const k={item:y};exports.KEY_GLOBAL_PROJECT=p;exports.MutationCollect=m;exports.MutationDataItem=y;exports.MutationGlobal=h;exports.MutationItemDesign=M;exports.MutationStatus=l;exports.propsMutationItem=k;
